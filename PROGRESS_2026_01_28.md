# Phase 3-3: Triple Tournament Results
**Date:** 2026-01-28

---

## Executive Summary

**"과연 최신 이론(Z-Score)이 무식한 전수조사(4Cn)를 이겼는가?"**

**답: NO. Classic 논문 기반 전략(Handover)이 최종 우승**

| Track | Champion | IS Return | OOS Return | OOS WinRate | 결과 |
|-------|----------|-----------|------------|-------------|------|
| A (전수조사) | 개인BUY & 외국인BUY & 금투BUY | 16.45% | N/A | N/A | 과적합 |
| **B (Classic)** | **Handover** | **2.17%** | **8.48%** | **56.2%** | **WINNER** |
| C (Z-Score) | Foreigner_Extreme_Buy | 2.58% | 8.06% | 54.7% | 2위 |

---

## 공통 전제 조건 (Common Baseline)

모든 트랙은 아래 1차 필터를 통과한 종목들만 대상으로 분석:

```
Base Signal: VR >= 3.0 AND Price_Change >= 5%

Data Universe:
- In-Sample (IS): 2021-01-01 ~ 2024-12-31 → 3,879 signals
- Out-of-Sample (OOS): 2025-01-01 ~ 2025-12-31 → 1,489 signals
```

---

## 3대 전략 비교 분석

### Track A: 4Cn 전수조사 (The Bruteforce)

**철학:** "편견 없이 모든 가능성을 탐색한다"

**결과:**
- 80개 조합 중 78개 유효 (IS)
- **IS Top 1:** 개인BUY & 외국인BUY & 금융투자BUY = 16.45%
- **문제점:** 시그널 17건 → OOS에서 데이터 없음 (과적합)

**Top 5 IS 성과:**

| 순위 | 조합 | 20D Return | WinRate | Signals |
|------|------|------------|---------|---------|
| 1 | 개인BUY & 외국인BUY & 금융투자BUY | 16.45% | 47.1% | 17 |
| 2 | 개인BUY & 외국인BUY & 금융투자BUY & 연기금SELL | 16.45% | 47.1% | 17 |
| 3 | 개인BUY & 외국인BUY & 연기금SELL | 7.34% | 47.3% | 74 |
| 4 | 개인BUY & 외국인BUY | 6.05% | 49.5% | 97 |
| 5 | 외국인SELL & 금융투자SELL & 연기금SELL | 5.23% | 47.1% | 308 |

**교훈:**
- 조합이 많아질수록 시그널 급감
- IS 성과가 높을수록 과적합 위험 증가
- OOS 검증 없이 IS 성과만 보면 안 됨

---

### Track B: Classic 논문 기반 (The Logic)

**철학:** "스마트 머니의 방향성과 개인의 이탈이 핵심이다" (Sias et al., 2004)

**시나리오:**

| 시나리오 | 조건 | IS Return | OOS Return | IS Signals |
|----------|------|-----------|------------|------------|
| Smart_Alignment | 외국인 BUY AND 연기금 BUY | 1.74% | 7.59% | 1,719 |
| Retail_Exhaustion | 개인 SELL | 2.13% | 8.56% | 2,872 |
| **Handover** | **개인 SELL AND (외국인 OR 연기금 BUY)** | **2.17%** | **8.48%** | **2,850** |

**Handover 전략 상세:**
```
조건: 개인이 팔고 (SELL) + 스마트머니가 사는 (외국인 OR 연기금 BUY)

해석: "개인 투자자가 공포에 매도할 때,
      외국인이나 연기금이 받아주면 그 종목은 오른다"

IS (2021-2024):
- 시그널: 2,850건
- 20D Return: 2.17%
- Win Rate: 44.6%

OOS (2025):
- 시그널: 1,065건
- 20D Return: 8.48% (+292% 개선!)
- Win Rate: 56.2%
```

**왜 Handover가 이겼는가:**
1. **충분한 시그널 수** (2,850건) → 통계적 신뢰도
2. **단순한 로직** → 과적합 회피
3. **경제학적 의미** → "약한 손(개인)에서 강한 손(기관)으로 이동"

---

### Track C: Modern SOTA (The Z-Score)

**철학:** "평소보다 얼마나 이례적인가(Anomaly)가 중요하다"

**시나리오:**

| 시나리오 | 조건 | IS Return | OOS Return | Signals |
|----------|------|-----------|------------|---------|
| **Foreigner_Extreme_Buy** | 외국인 Z > 2.0 | 2.58% | 8.06% | 1,610 |
| Institution_Extreme_Buy | 금융투자 Z > 2.0 | 2.51% | - | 674 |
| Foreigner_OR_Retail | 외국인 Z>2 OR 개인 Z<-2 | 2.42% | - | 1,889 |
| Foreigner_Moderate | 외국인 Z > 1.0 | 2.31% | - | 2,120 |
| Retail_Extreme_Sell | 개인 Z < -2.0 | 2.27% | - | 1,760 |

**Z-Score 전략 한계:**
1. 60일 rolling window 필요 → 초기 60일 데이터 손실
2. 극단값(Z > 2.0) 필터 → 시그널 감소
3. Classic 대비 복잡성 증가 but 성과 차이 미미

---

## Final Verdict

### 최종 순위 (OOS 기준)

| 순위 | Track | Strategy | OOS Return | OOS WinRate | 판정 |
|------|-------|----------|------------|-------------|------|
| 1 | **B** | **Handover** | **8.48%** | **56.2%** | **CHAMPION** |
| 2 | C | Foreigner_Extreme_Buy | 8.06% | 54.7% | Runner-up |
| 3 | A | (과적합으로 탈락) | N/A | N/A | Disqualified |

### Key Takeaways

1. **단순함의 승리**
   - Track A의 3~4개 조합보다 Track B의 1~2개 조건이 더 강건
   - "개인 SELL + 스마트머니 BUY"라는 직관적 로직

2. **IS 성과 =/= OOS 성과**
   - Track A IS Top1 (16.45%) → OOS 탈락
   - Track B IS (2.17%) → OOS (8.48%) = 4배 개선

3. **Z-Score는 유용하지만 결정적이지 않음**
   - Classic 대비 +0.4%p 개선에 그침
   - 복잡성 대비 효용 의문

4. **Golden Filter 업데이트**
```python
GOLDEN_FILTER_FINAL = {
    # Stage 1: Rough Signal
    'VR_threshold': 3.0,
    'Price_threshold': 5.0,

    # Stage 2: Handover Filter (Tournament Winner)
    'quality_filter': 'Handover',
    'conditions': {
        '개인': 'SELL',  # <= 0
        '외국인_OR_연기금': 'BUY'  # > 0
    },

    # 기대 성과
    'is_return': 2.17,
    'oos_return': 8.48,
    'oos_winrate': 56.2,
    'oos_signals': 1065,
}
```

---

## Appendix: Raw Data Summary

### Data Universe
- **Period:** 2021-01-01 ~ 2025-12-31
- **Base Signal:** VR >= 3.0 AND Price >= 5%
- **IS Signals:** 3,879
- **OOS Signals:** 1,489

### Track A Statistics
- Total Combinations: 80
- Valid IS Results: 78
- Valid OOS Results: 72

### Files Generated
- `results/p3_03_tournament_results.csv` - 전체 결과
- `results/p3_03_tournament_champions.csv` - Champion 비교

---

## Phase 3-3 Extended: Multi-Duration Tournament

### 가설 (Hypothesis)

**"20일 보유 전략에는 그에 맞는 누적 수급(Accumulated Supply) 분석이 필요하다"**

### 실험 설계

```
Duration List: [1, 3, 5, 7, 10, 20] days

Track A: Constrained Combinatorial (Anti-Overfitting)
- 4C_3 (3주체): 반드시 1개 이상의 SELL 포함
- 4C_4 (4주체): 반드시 2개 이상의 SELL 포함

Track B: Classic with D-Day Accumulated Supply
Track C: Z-Score on D-Day Accumulated Supply

Rolling Sum: 각 Duration에 대해 D일간 누적 수급 계산
Z-Score: (D-day sum - 60일 rolling mean) / std
```

### 가설 검증 결과: REJECTED

| Duration | 평균 OOS Return |
|----------|-----------------|
| 1D | **8.77%** (Best) |
| 3D | 8.63% |
| 5D | 8.34% |
| 7D | 8.46% |
| 10D | 8.07% |
| 20D | 8.32% |

```
20D Supply Analysis avg: 8.32%
Other Durations avg:     8.46%

Result: REJECTED - 단기 수급(1D, 3D)이 오히려 더 예측력이 좋음
```

### Top 전략 (OOS Performance)

**Track A: Constrained Combinatorial**
| Rank | Strategy | Duration | Return | WinRate |
|------|----------|----------|--------|---------|
| 1 | Retail_SELL & Foreign_SELL & Pension_SELL | 20D | 18.43% | 63.6% |
| 2 | Retail_SELL & Foreign_SELL & FinInvest_BUY & Pension_SELL | 20D | 18.43% | 63.6% |
| 3 | Retail_BUY & Foreign_SELL & FinInvest_BUY & Pension_SELL | 3D | 16.91% | 63.5% |

**Track B: Classic Academic**
| Rank | Strategy | Duration | Return | WinRate |
|------|----------|----------|--------|---------|
| 1 | **Pension_SELL** | 3D | **11.72%** | **58.1%** |
| 2 | Pension_SELL | 1D | 11.50% | 56.9% |
| 3 | Pension_SELL | 5D | 10.77% | 58.2% |

**Track C: Z-Score**
| Rank | Strategy | Duration | Return | WinRate |
|------|----------|----------|--------|---------|
| 1 | **Pension_Z < -1** | 3D | **11.93%** | **56.0%** |
| 2 | Pension_Z < -1 | 1D | 11.75% | 58.2% |
| 3 | Retail_Z < -2 | 20D | 10.71% | 56.4% |

### Key Findings

1. **연기금 SELL이 핵심 팩터**
   - 모든 Track에서 연기금 SELL (또는 Z < -1) 전략이 상위권
   - 연기금이 매도할 때 매수하면 수익

2. **가설 기각: 단기 수급이 더 효과적**
   - 20일 보유에 20일 누적 수급이 필요하다는 가설 기각
   - 오히려 1~3일 단기 수급이 더 예측력 높음
   - 해석: "당일/최근 며칠의 급격한 수급 변화가 중요"

3. **Anti-Overfitting 제약의 효과**
   - Track A에서 Must-SELL 제약으로 과적합 일부 방지
   - 하지만 Top 1 (18.43%)은 여전히 11건 시그널로 과적합 위험

4. **실전 적용 가능 전략**
   ```python
   # 신뢰할 수 있는 전략 (충분한 시그널 + 높은 수익률)
   RELIABLE_STRATEGY = {
       'name': 'Pension_SELL_3D',
       'condition': '연기금 3일 누적 <= 0',
       'oos_return': 11.72,
       'oos_winrate': 58.1,
       'track': 'B'
   }
   ```

### Files Generated
- `src/phase3/p3_03_multi_duration_tournament.py`
- `results/p3_03_multi_duration_results.csv`
- `results/p3_03_multi_duration_heatmap.csv`

---

**Author:** Claude Opus 4.5
**Last Updated:** 2026-01-29 KST
